// Copyright (c) 2024 TaguchiKiichi. All rights reserved.
// This Software collects user data such as Email addresses, usernames, and IDs.
// The data is managed by the copyright holder and may be used for Software maintenance.
// Modification, copying, and redistribution are prohibited. Use at your own risk.

const _0x495a9e=_0x43ed;(function(_0x184735,_0x59ea77){const _0x5d028b=_0x43ed,_0x1a184b=_0x184735();while(!![]){try{const _0x2ca65e=-parseInt(_0x5d028b(0x176))/0x1+parseInt(_0x5d028b(0x17f))/0x2*(parseInt(_0x5d028b(0x15e))/0x3)+-parseInt(_0x5d028b(0x139))/0x4+-parseInt(_0x5d028b(0x1a0))/0x5+parseInt(_0x5d028b(0x11d))/0x6*(parseInt(_0x5d028b(0x1ab))/0x7)+-parseInt(_0x5d028b(0x179))/0x8+-parseInt(_0x5d028b(0x195))/0x9*(-parseInt(_0x5d028b(0x1b0))/0xa);if(_0x2ca65e===_0x59ea77)break;else _0x1a184b['push'](_0x1a184b['shift']());}catch(_0x208465){_0x1a184b['push'](_0x1a184b['shift']());}}}(_0x1ca4,0x18ec2));let OnQuestion=location['pathname']==_0x495a9e(0x180),OldLoc;!OnQuestion&&(OldLoc=location['pathname']);function makeDraggable(_0xdcca72){const _0xf6ea08=_0x495a9e;let _0x51b46d=0x0,_0x47778a=0x0,_0x40d041=0x0,_0x43f85e=0x0;_0xdcca72[_0xf6ea08(0x143)]=function(_0x1da49e){const _0x424f61=_0xf6ea08;_0x1da49e[_0x424f61(0x11c)](),_0x40d041=_0x1da49e['clientX'],_0x43f85e=_0x1da49e['clientY'],document['onmouseup']=_0x122d4b,document[_0x424f61(0x15c)]=_0x53b60a;};function _0x53b60a(_0x2e7830){const _0x2ea9ae=_0xf6ea08;_0x2e7830['preventDefault'](),_0x51b46d=_0x40d041-_0x2e7830[_0x2ea9ae(0x17c)],_0x47778a=_0x43f85e-_0x2e7830[_0x2ea9ae(0x14c)],_0x40d041=_0x2e7830[_0x2ea9ae(0x17c)],_0x43f85e=_0x2e7830['clientY'],_0xdcca72['style'][_0x2ea9ae(0x144)]=_0xdcca72['offsetTop']-_0x47778a+'px',_0xdcca72[_0x2ea9ae(0x14e)][_0x2ea9ae(0x13b)]=_0xdcca72[_0x2ea9ae(0x1a8)]-_0x51b46d+'px';}function _0x122d4b(){const _0x3f0e63=_0xf6ea08;document[_0x3f0e63(0x17a)]=null,document[_0x3f0e63(0x15c)]=null;}}function StartLoad(){const _0x18d5ff=_0x495a9e;document['getElementById'](_0x18d5ff(0x1a9))[_0x18d5ff(0x14e)]['display']=_0x18d5ff(0x15d);}function ExitLoad(){const _0x30dbd8=_0x495a9e;document['getElementById'](_0x30dbd8(0x1a9))['style']['display']=_0x30dbd8(0x18f);}let InjectHTML=_0x495a9e(0x184),AnswerData,ScriptVersion=_0x495a9e(0x18c),UserData={'AuthToken':'','TestID':''},AutoClearData={'ClassID':'','TaskID':''},UserConfig={'CorrectAnswerRate':0x3c},AnswerAssist=![],FakeMissGen=!![];function _0x43ed(_0x2949d1,_0x5a27cb){const _0x1ca4e0=_0x1ca4();return _0x43ed=function(_0x43ed25,_0x3f28ae){_0x43ed25=_0x43ed25-0x111;let _0x539809=_0x1ca4e0[_0x43ed25];return _0x539809;},_0x43ed(_0x2949d1,_0x5a27cb);}const sleep=_0x4c0d73=>new Promise(_0x4bce77=>setTimeout(_0x4bce77,_0x4c0d73));async function ShowCustomPop(_0x233428){const _0x3247e0=_0x495a9e;document[_0x3247e0(0x162)]('customPop')[_0x3247e0(0x14e)][_0x3247e0(0x13d)]=_0x3247e0(0x15d),document[_0x3247e0(0x162)](_0x3247e0(0x160))['textContent']=_0x233428,await sleep(0x1f4),document[_0x3247e0(0x162)](_0x3247e0(0x160))[_0x3247e0(0x14e)]['display']=_0x3247e0(0x18f);}function AssistFunc(){const _0x1692ab=_0x495a9e;for(let _0x28a2e3=0x0;_0x28a2e3<document['getElementById']('answerPop')[_0x1692ab(0x1a2)][_0x1692ab(0x127)];_0x28a2e3++){document[_0x1692ab(0x162)](_0x1692ab(0x183))[_0x1692ab(0x1a2)][_0x28a2e3][_0x1692ab(0x14e)]['backgroundColor']=_0x1692ab(0x13f);}document[_0x1692ab(0x162)](_0x1692ab(0x183))[_0x1692ab(0x1a2)][Number(document[_0x1692ab(0x186)](_0x1692ab(0x16e))[0x0]['textContent'][_0x1692ab(0x11e)]('\x20','')['replaceAll']('\x0a','')[_0x1692ab(0x191)]('/')[0x0])+0x3][_0x1692ab(0x14e)][_0x1692ab(0x15a)]=_0x1692ab(0x111),console[_0x1692ab(0x1b2)](_0x1692ab(0x171));}const callback=_0x51a466=>{const _0x8f166d=_0x495a9e;for(const _0x3478a5 of _0x51a466){_0x3478a5[_0x8f166d(0x147)]===_0x8f166d(0x187)&&_0x3478a5[_0x8f166d(0x16b)][_0x8f166d(0x146)](_0x4a4b29=>{const _0x508899=_0x8f166d;_0x4a4b29['nodeType']===Node[_0x508899(0x169)]&&_0x4a4b29[_0x508899(0x13c)][_0x508899(0x188)]('loading')&&AnswerAssist&&AssistFunc();});}},config={'childList':!![],'subtree':!![]},observer=new MutationObserver(callback);function CloseElem(){const _0x142b88=_0x495a9e;document[_0x142b88(0x162)](_0x142b88(0x183))['style'][_0x142b88(0x13d)]=_0x142b88(0x18f);}function CloseElem2(){const _0x1ae524=_0x495a9e;document[_0x1ae524(0x162)](_0x1ae524(0x19f))[_0x1ae524(0x14e)][_0x1ae524(0x13d)]=_0x1ae524(0x18f);}function GetUserData(){const _0x366686=_0x495a9e;ucfg=localStorage[_0x366686(0x154)]('UtilityConfig');ucfg?console[_0x366686(0x1b2)](ucfg):(localStorage['setItem'](_0x366686(0x152),JSON['stringify'](UserConfig)),console['log'](ucfg));UserData[_0x366686(0x120)]=localStorage[_0x366686(0x154)](_0x366686(0x15f)),AutoClearData[_0x366686(0x165)]=location[_0x366686(0x114)][_0x366686(0x191)]('/')[0x3],AutoClearData[_0x366686(0x19b)]=JSON[_0x366686(0x13a)](localStorage[_0x366686(0x154)](_0x366686(0x170)))[_0x366686(0x197)][_0x366686(0x132)][_0x366686(0x1b1)];const _0x13111a='https://app-api.abceed.com/web/world_practices/info?id_task='+location[_0x366686(0x114)][_0x366686(0x191)]('/')[0x3];fetch(_0x13111a,{'method':_0x366686(0x11f),'headers':{'Authorization':'Bearer\x20'+UserData[_0x366686(0x120)],'sec-ch-ua':'\x22Not)A;Brand\x22;v=\x2299\x22,\x20\x22Google\x20Chrome\x22;v=\x22127\x22,\x20\x22Chromium\x22;v=\x22127\x22','sec-ch-ua-mobile':'?0','sec-ch-ua-platform':_0x366686(0x194),'Sec-Fetch-Dest':'empty','Sec-Fetch-Mode':_0x366686(0x12c),'Sec-Fetch-Site':_0x366686(0x153),'User-Agent':_0x366686(0x125),'X-User-Agent':_0x366686(0x126),'Content-Type':_0x366686(0x163)}})['then'](_0x571338=>{const _0x43e013=_0x366686;if(!_0x571338['ok'])throw new Error(_0x43e013(0x1a6));return _0x571338[_0x43e013(0x159)]();})[_0x366686(0x151)](_0x1ecbb0=>{const _0x34d957=_0x366686;UserData[_0x34d957(0x17d)]=_0x1ecbb0[_0x34d957(0x174)][_0x34d957(0x149)];})['catch'](_0x133028=>{const _0x31a81e=_0x366686;console[_0x31a81e(0x1a5)]('Error:',_0x133028);}),ShowCustomPop('Success');}function ToggleAssist(){const _0x41cf9c=_0x495a9e;if(location[_0x41cf9c(0x114)]!=_0x41cf9c(0x180)){alert(_0x41cf9c(0x177));return;}AnswerAssist?(document[_0x41cf9c(0x162)](_0x41cf9c(0x19d))[_0x41cf9c(0x14e)]['setProperty'](_0x41cf9c(0x16f),'white',_0x41cf9c(0x140)),document['getElementById'](_0x41cf9c(0x19d))[_0x41cf9c(0x14e)]['setProperty'](_0x41cf9c(0x17e),_0x41cf9c(0x1a1),_0x41cf9c(0x140)),AnswerAssist=!AnswerAssist,ShowCustomPop(_0x41cf9c(0x18e)),observer[_0x41cf9c(0x19c)]()):(document[_0x41cf9c(0x162)]('tglAst')[_0x41cf9c(0x14e)][_0x41cf9c(0x1ae)](_0x41cf9c(0x16f),_0x41cf9c(0x14d),_0x41cf9c(0x140)),document[_0x41cf9c(0x162)]('tglAst')['style'][_0x41cf9c(0x1ae)](_0x41cf9c(0x17e),_0x41cf9c(0x13f),_0x41cf9c(0x140)),AnswerAssist=!AnswerAssist,ShowCustomPop('Assist\x20ON'),AssistFunc(),observer[_0x41cf9c(0x145)](document[_0x41cf9c(0x122)],config));}function ShowAnswer(){const _0x35e241=_0x495a9e,_0x385b1e=_0x35e241(0x172)+location[_0x35e241(0x114)]['split']('/')[0x3];StartLoad(),fetch(_0x385b1e,{'method':_0x35e241(0x11f),'headers':{'Authorization':_0x35e241(0x168)+UserData[_0x35e241(0x120)],'sec-ch-ua':_0x35e241(0x1a4),'sec-ch-ua-mobile':'?0','sec-ch-ua-platform':_0x35e241(0x194),'Sec-Fetch-Dest':_0x35e241(0x136),'Sec-Fetch-Mode':_0x35e241(0x12c),'Sec-Fetch-Site':_0x35e241(0x153),'User-Agent':_0x35e241(0x125),'X-User-Agent':_0x35e241(0x126),'Content-Type':_0x35e241(0x163)}})[_0x35e241(0x151)](_0x5afe18=>{const _0x39ce12=_0x35e241;if(!_0x5afe18['ok'])throw new Error(_0x39ce12(0x1a6));return _0x5afe18['json']();})[_0x35e241(0x151)](_0x3a1391=>{const _0xb660c3=_0x35e241;console['log'](_0xb660c3(0x134),_0x3a1391[_0xb660c3(0x142)]),AnswerData=_0x3a1391[_0xb660c3(0x142)],ansPop=document[_0xb660c3(0x162)](_0xb660c3(0x183)),makeDraggable(ansPop),ansPop[_0xb660c3(0x173)]=_0xb660c3(0x13e),te=document[_0xb660c3(0x12a)]('h1'),te[_0xb660c3(0x164)]=_0xb660c3(0x121),ansPop['appendChild'](te),AnswerListElem=document[_0xb660c3(0x12a)]('a'),AnswerListElem[_0xb660c3(0x173)]='英語\x20日本語<hr\x20style=\x22border:\x20none\x20!important;border-top:\x201px\x20solid\x20black\x20!important;margin:\x200\x20!important;\x22><br>',ansPop[_0xb660c3(0x1ac)](AnswerListElem),_0x3a1391[_0xb660c3(0x142)][_0xb660c3(0x146)](_0x1ef076=>{const _0x2d0414=_0xb660c3;AnswerListElem=document['createElement']('a'),AnswerListElem['innerHTML']=_0x1ef076[_0x2d0414(0x12e)]+'\x20'+_0x1ef076['word_ja']+_0x2d0414(0x196),ansPop[_0x2d0414(0x1ac)](AnswerListElem);}),ansPop[_0xb660c3(0x14e)]['display']=_0xb660c3(0x15d);})[_0x35e241(0x11b)](_0x515a5c=>{const _0x2ba196=_0x35e241;console['error'](_0x2ba196(0x131),_0x515a5c);})[_0x35e241(0x167)](()=>{ExitLoad();});}async function RunAuto(){const _0x1df545=_0x495a9e;ShowCustomPop('Boot\x20system...'),cfg={'ClassID':AutoClearData[_0x1df545(0x19b)],'TaskID':AutoClearData[_0x1df545(0x165)],'authorization':UserData['AuthToken'],'TestID':UserData[_0x1df545(0x17d)]},await AutoClear(cfg);}function _0x1ca4(){const _0x2a7bdc=['cors','true_answer','word','enable','email','Error:','focusedClassInfo','Miss!','Success:','https://github.com/TaguchiKiichi/Abceed-Utility','empty','click','All\x20Clearと出ても処理が少し続くので、開始してから10秒ほど待機してください','402264Jndvwk','parse','left','classList','display','<a\x20id=\x22closeBtn\x22\x20onclick=\x22javascript:CloseElem()\x22>×</a>','white','important','firstChild','all_question_list','onmousedown','top','observe','forEach','type','https://abceed-utiliy-auth.deno.dev/latestuse','id_test','Authed','add','clientY','royalblue','style','host','POST','then','UtilityConfig','same-site','getItem','showHubbox','app.abceed.com','value','auth\x20start','json','backgroundColor','random','onmousemove','block','3ILMwVd','abcJwtToken','customPop','Error\x20:','getElementById','application/json','textContent','TaskID','https://abceed-utiliy-auth.deno.dev/version','finally','Bearer\x20','ELEMENT_NODE','CorrectAnswerRate','addedNodes','application/json,\x20text/plain,\x20*/*','status','marksheet-answer__number','background-color','abceed','changed','https://app-api.abceed.com/web/world_practices/info?id_task=','innerHTML','task_info','authorization','203020fUgdJO','タスクを開始してから押してください','focus','698960LnbPPy','onmouseup','https://app-api.abceed.com/web/question/grading','clientX','TestID','color','383710OgTUIq','/books/study/word-test-confirm/quiz','UtilityAuth','insertBefore','answerPop','PHN0eWxlPgogIC5kcmFnZ2FibGUgewogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsKICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICB0b3A6IDUwcHg7CiAgICAgIGxlZnQ6IDUwcHg7CiAgICAgIGN1cnNvcjogbW92ZTsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIGJvcmRlcjogMnB4IHNvbGlkIGJsYWNrOwogICAgICBwYWRkaW5nLWxlZnQ6IDIwcHg7CiAgICAgIHotaW5kZXg6IDEwMDA7CiAgICAgIHVzZXItc2VsZWN0OiBub25lOwogIH0KCiAgLnN3aXRjaGJ0biB7CiAgICBib3JkZXI6IDJweCBzb2xpZCByZ2IoMTYsIDEwOSwgMTQwKTsKICAgICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7CiAgICAgIGNvbG9yOiBibGFjazsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogIH0KCiAgI2h1YmJveCB7CiAgICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlOwogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgIGRpc3BsYXk6IG5vbmU7CiAgICAgIGN1cnNvcjogbW92ZTsKICAgICAgYm9yZGVyOiAycHggc29saWQgYmxhY2s7CiAgICAgIHBhZGRpbmc6IDIwcHggMjBweCAyMHB4IDIwcHg7CiAgICAgIHotaW5kZXg6ICAgOTk5OwogIH0KCiAgLnBvcCB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogIH0KCiNsb2FkaW5nUG9wIHsKICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7CiAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgZGlzcGxheTogbm9uZTsKICAgYm9yZGVyOiAycHggc29saWQgYmxhY2s7CiAgIHBhZGRpbmc6IDIwcHggMjBweCAyMHB4IDIwcHg7Cn0KCiNhbnN3ZXJQb3AgewogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsKICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICBkaXNwbGF5OiBub25lOwogICAgICBjdXJzb3I6IG1vdmU7CiAgICAgIGJvcmRlcjogMnB4IHNvbGlkIGJsYWNrOwogICAgICBwYWRkaW5nOiAyMHB4IDIwcHggMjBweCAyMHB4OwogICAgICB6LWluZGV4OiAgIDk5OTsKfQoKI2NvbmZpZ1BvcCB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsKICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICBkaXNwbGF5OiBub25lOwogICAgICBjdXJzb3I6IG1vdmU7CiAgICAgIGJvcmRlcjogMnB4IHNvbGlkIGJsYWNrOwogICAgICBwYWRkaW5nOiAyMHB4IDIwcHggMjBweCAyMHB4OwogICAgICB6LWluZGV4OiAgIDk5OTsKfQoKI2Nsb3NlQnRuIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAxMHB4OwogIHJpZ2h0OiAxMHB4OwogIGN1cnNvcjogcG9pbnRlcjsKfQoKI2N1c3RvbVBvcCB7CiAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlOwogICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgIGRpc3BsYXk6IG5vbmU7CiAgIGJvcmRlcjogMnB4IHNvbGlkIGJsYWNrOwogICBwYWRkaW5nOiAyMHB4IDIwcHggMjBweCAyMHB4Owp9CgogIC5kcmFnIHsKICAgICAgei1pbmRleDogMTAwMTsKICB9Cjwvc3R5bGU+Cgo8ZGl2IGlkPSJkcmFnZ2FibGVFbGVtZW50IiBjbGFzcz0iZHJhZ2dhYmxlIj4KICA8YnV0dG9uIGlkPSJzaG93SHViYm94IiBjbGFzcz0ic3dpdGNoYnRuIj5BYmNlZWQgVXRpbGl0eTwvYnV0dG9uPgo8L2Rpdj4KCjxkaXYgaWQ9Imh1YmJveCI+CiAgPGgxPjxiPkFiY2VlZCBVdGlsaXR5IEh1YjwvYj48L2gxPgogIDxhIG9uY2xpY2s9ImphdmFzY3JpcHQ6R2V0VXNlckRhdGEoKSI+SW5pdGFsaXplPC9hPjxicj4KPGEgb25jbGljaz0iamF2YXNjcmlwdDpTaG93QW5zd2VyKCkiPlZpZXcgQW5zd2VyPC9hPjxicj4KPGEgaWQ9InRnbEFzdCIgb25jbGljaz0iamF2YXNjcmlwdDpUb2dnbGVBc3Npc3QoKSI+QW5zd2VyIEFzc2lzdDwvYT48YnI+CjxhIG9uY2xpY2s9ImphdmFzY3JpcHQ6UnVuQXV0bygpIj5BdXRvIENvbXBsZXRlPC9hPjxicj4KPGhyPgo8YSBvbmNsaWNrPSJqYXZhc2NyaXB0Ok9wZW5DZmcoKSI+Q29uZmlnIFNldHRpbmc8L2E+CjxkaXYgY2xhc3M9InBvcCI+CiAgPGgxIGlkPSJsb2FkaW5nUG9wIj5Mb2FkaW5nLi4uPC9oMT4KICA8aDEgaWQ9ImN1c3RvbVBvcCI+PC9oMT4KPC9kaXY+CjwvZGl2Pgo8ZGl2IGlkPSJhbnN3ZXJQb3AiPgogIDxhIGlkPSJjbG9zZUJ0biIgb25jbGljaz0iamF2YXNjcmlwdDpDbG9zZUVsZW0oKSI+eDwvYT4KPC9kaXY+CjxkaXYgaWQ9ImNvbmZpZ1BvcCI+CiAgICA8YSBpZD0iY2xvc2VCdG4iIG9uY2xpY2s9ImphdmFzY3JpcHQ6Q2xvc2VFbGVtMigpIj54PC9hPgogICAgPGE+Q29ycmVjdCBBbnN3ZXIgUmF0ZSA6PC9hPjxpbnB1dCB0eXBlPSJudW1iZXIiIGlkPSJjYVJhdGUiPjxiZj4KICAgIDxhIG9uY2xpY2s9ImphdmFzY3JpcHQ6VXBkYXRlQ2ZnKCkiPlNhdmU8L2E+CiAgPC9kaXY+Cgo8c2NyaXB0PgogICAgLy9ib290IGpzCiAgICBsZXQgT25RdWVzdGlvbiA9IChsb2NhdGlvbi5wYXRobmFtZSA9PSAiL2Jvb2tzL3N0dWR5L3dvcmQtdGVzdC1jb25maXJtL3F1aXoiKTsKICAgIGxldCBPbGRMb2M7CiAgICBpZiAoIU9uUXVlc3Rpb24pIHsKICAgICAgICBPbGRMb2MgPSBsb2NhdGlvbi5wYXRobmFtZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gbWFrZURyYWdnYWJsZShlbGVtZW50KSB7CiAgICAgICAgbGV0IG9mZnNldFggPSAwLCBvZmZzZXRZID0gMCwgbW91c2VYID0gMCwgbW91c2VZID0gMDsKICAgIAogICAgICAgIGVsZW1lbnQub25tb3VzZWRvd24gPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgbW91c2VYID0gZS5jbGllbnRYOwogICAgICAgICAgICBtb3VzZVkgPSBlLmNsaWVudFk7CiAgICAgICAgICAgIGRvY3VtZW50Lm9ubW91c2V1cCA9IGNsb3NlRHJhZ0VsZW1lbnQ7CiAgICAgICAgICAgIGRvY3VtZW50Lm9ubW91c2Vtb3ZlID0gZWxlbWVudERyYWc7CiAgICAgICAgfTsKICAgIAogICAgICAgIGZ1bmN0aW9uIGVsZW1lbnREcmFnKGUpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBvZmZzZXRYID0gbW91c2VYIC0gZS5jbGllbnRYOwogICAgICAgICAgICBvZmZzZXRZID0gbW91c2VZIC0gZS5jbGllbnRZOwogICAgICAgICAgICBtb3VzZVggPSBlLmNsaWVudFg7CiAgICAgICAgICAgIG1vdXNlWSA9IGUuY2xpZW50WTsKICAgICAgICAgICAgZWxlbWVudC5zdHlsZS50b3AgPSAoZWxlbWVudC5vZmZzZXRUb3AgLSBvZmZzZXRZKSArICJweCI7CiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUubGVmdCA9IChlbGVtZW50Lm9mZnNldExlZnQgLSBvZmZzZXRYKSArICJweCI7CiAgICAgICAgfQogICAgCiAgICAgICAgZnVuY3Rpb24gY2xvc2VEcmFnRWxlbWVudCgpIHsKICAgICAgICAgICAgZG9jdW1lbnQub25tb3VzZXVwID0gbnVsbDsKICAgICAgICAgICAgZG9jdW1lbnQub25tb3VzZW1vdmUgPSBudWxsOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gU3RhcnRMb2FkKCkgewogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibG9hZGluZ1BvcCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBFeGl0TG9hZCgpIHsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxvYWRpbmdQb3AiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgfQogICAgCiAgICAvL2FiY2VlZCBzY3JpcHQKICAgIGxldCBBbnN3ZXJEYXRhOwoKICAgIGxldCBVc2VyRGF0YSA9IHsKICAgICAgICBBdXRoVG9rZW4gOiAiIiwKICAgICAgICBUZXN0SUQ6ICIiLAogICAgfQoKICAgIGxldCBBdXRvQ2xlYXJEYXRhID0gewogICAgICAgIENsYXNzSUQgOiAiIiwKICAgICAgICBUYXNrSUQgOiAiIiwKICAgIH0KICAgIAogICAgbGV0IEFuc3dlckFzc2lzdCA9IGZhbHNlOwogICAgbGV0IEZha2VNaXNzR2VuID0gdHJ1ZTsKICAgIAogICAgY29uc3Qgc2xlZXAgPSAodGltZSkgPT4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgdGltZSkpOwogICAgCiAgICBhc3luYyBmdW5jdGlvbiBTaG93Q3VzdG9tUG9wKG1zKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImN1c3RvbVBvcCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjdXN0b21Qb3AiKS50ZXh0Q29udGVudCA9IG1zOwogICAgICAgIGF3YWl0IHNsZWVwKDUwMCk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImN1c3RvbVBvcCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIEFzc2lzdEZ1bmMoKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYW5zd2VyUG9wIikuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFuc3dlclBvcCIpLmNoaWxkcmVuW2ldLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICJ3aGl0ZSI7CiAgICAgICAgfQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhbnN3ZXJQb3AiKS5jaGlsZHJlbltOdW1iZXIoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgibWFya3NoZWV0LWFuc3dlcl9fbnVtYmVyIilbMF0udGV4dENvbnRlbnQucmVwbGFjZUFsbCgiICIsIiIpLnJlcGxhY2VBbGwoIlxuIiwiIikuc3BsaXQoIi8iKVswXSkrM10uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gInllbGxvdyI7CiAgICAgICAgY29uc29sZS5sb2coImNoYW5nZWQiKTsKICAgIH0KICAgIAogICAgY29uc3QgY2FsbGJhY2sgPSAobXV0YXRpb25zTGlzdCkgPT4gewogICAgICAgIGZvciAoY29uc3QgbXV0YXRpb24gb2YgbXV0YXRpb25zTGlzdCkgewogICAgICAgICAgICBpZiAobXV0YXRpb24udHlwZSA9PT0gJ2NoaWxkTGlzdCcpIHsKICAgICAgICAgICAgICAgIG11dGF0aW9uLmFkZGVkTm9kZXMuZm9yRWFjaChub2RlID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gTm9kZS5FTEVNRU5UX05PREUgJiYgbm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ2xvYWRpbmcnKSAmJiBBbnN3ZXJBc3Npc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgQXNzaXN0RnVuYygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIAogICAgY29uc3QgY29uZmlnID0geyBjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWUgfTsKICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoY2FsbGJhY2spOwogICAgCiAgICBmdW5jdGlvbiBDbG9zZUVsZW0oKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFuc3dlclBvcCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICB9CiAgICBmdW5jdGlvbiBDbG9zZUVsZW0yKCkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maWdQb3AiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgfQoKZnVuY3Rpb24gR2V0VXNlckRhdGEoKSB7CiAgICBVc2VyRGF0YS5BdXRoVG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiYWJjSnd0VG9rZW4iKTsKICAgIEF1dG9DbGVhckRhdGEuVGFza0lEID0gbG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoIi8iKVszXTsKICAgIEF1dG9DbGVhckRhdGEuQ2xhc3NJRCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oImFiY2VlZCIpKS5jbGFzc2VzLmZvY3VzZWRDbGFzc0luZm8uaWRfY2xhc3M7CgoKICAgIGNvbnN0IHVybCA9ICdodHRwczovL2FwcC1hcGkuYWJjZWVkLmNvbS93ZWIvd29ybGRfcHJhY3RpY2VzL2luZm8/aWRfdGFzaz0nK2xvY2F0aW9uLnBhdGhuYW1lLnNwbGl0KCIvIilbM107CiAgICBmZXRjaCh1cmwsIHsKICAgICAgICBtZXRob2Q6ICdHRVQnLAogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiAnQmVhcmVyICcgKyBVc2VyRGF0YS5BdXRoVG9rZW4sCiAgICAgICAgICAgICdzZWMtY2gtdWEnOiAnIk5vdClBO0JyYW5kIjt2PSI5OSIsICJHb29nbGUgQ2hyb21lIjt2PSIxMjciLCAiQ2hyb21pdW0iO3Y9IjEyNyInLAogICAgICAgICAgICAnc2VjLWNoLXVhLW1vYmlsZSc6ICc/MCcsCiAgICAgICAgICAgICdzZWMtY2gtdWEtcGxhdGZvcm0nOiAnIkNocm9tZSBPUyInLAogICAgICAgICAgICAnU2VjLUZldGNoLURlc3QnOiAnZW1wdHknLAogICAgICAgICAgICAnU2VjLUZldGNoLU1vZGUnOiAnY29ycycsCiAgICAgICAgICAgICdTZWMtRmV0Y2gtU2l0ZSc6ICdzYW1lLXNpdGUnLAogICAgICAgICAgICAnVXNlci1BZ2VudCc6ICdNb3ppbGxhLzUuMCAoWDExOyBDck9TIHg4Nl82NCAxNDU0MS4wLjApIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMjcuMC4wLjAgU2FmYXJpLzUzNy4zNicsCiAgICAgICAgICAgICdYLVVzZXItQWdlbnQnOiAnYWJjZWVkLXdlYjo3LjEuMC9DaHJvbWU6MTI3LjAuNjUzMy4xMzInLAogICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgICAgfSwKICAgIH0pCiAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05ldHdvcmsgcmVzcG9uc2Ugd2FzIG5vdCBvaycpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogICAgfSkKICAgIC50aGVuKGRhdGEgPT4gewogICAgICAgIFVzZXJEYXRhLlRlc3RJRCA9IGRhdGEudGFza19pbmZvLmlkX3Rlc3Q7CiAgICB9KQogICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvcjonLCBlcnJvcik7CiAgICB9KTsKCiAgICBTaG93Q3VzdG9tUG9wKCJTdWNjZXNzIik7Cn0KCmZ1bmN0aW9uIFRvZ2dsZUFzc2lzdCgpIHsKICAgIGlmIChsb2NhdGlvbi5wYXRobmFtZSAhPSAiL2Jvb2tzL3N0dWR5L3dvcmQtdGVzdC1jb25maXJtL3F1aXoiKSB7CiAgICAgICAgYWxlcnQoIuOCv+OCueOCr+OCkumWi+Wni+OBl+OBpuOBi+OCieaKvOOBl+OBpuOBj+OBoOOBleOBhCIpOwogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKEFuc3dlckFzc2lzdCkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0Z2xBc3QiKS5zdHlsZS5zZXRQcm9wZXJ0eSgiYmFja2dyb3VuZC1jb2xvciIsIndoaXRlIiwiaW1wb3J0YW50Iik7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRnbEFzdCIpLnN0eWxlLnNldFByb3BlcnR5KCJjb2xvciIsImJsYWNrIiwiaW1wb3J0YW50Iik7CiAgICAgICAgQW5zd2VyQXNzaXN0ID0gIUFuc3dlckFzc2lzdDsKICAgICAgICBTaG93Q3VzdG9tUG9wKCJBc3Npc3QgT0ZGIik7CiAgICAgICAgb2JzZXJ2ZXIuZGlzY29ubmVjdCgpOwogICAgfSBlbHNlIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGdsQXN0Iikuc3R5bGUuc2V0UHJvcGVydHkoImJhY2tncm91bmQtY29sb3IiLCJyb3lhbGJsdWUiLCJpbXBvcnRhbnQiKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGdsQXN0Iikuc3R5bGUuc2V0UHJvcGVydHkoImNvbG9yIiwid2hpdGUiLCJpbXBvcnRhbnQiKTsKICAgICAgICBBbnN3ZXJBc3Npc3QgPSAhQW5zd2VyQXNzaXN0OwogICAgICAgIFNob3dDdXN0b21Qb3AoIkFzc2lzdCBPTiIpOwogICAgICAgIEFzc2lzdEZ1bmMoKTsKICAgICAgICAKICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHksIGNvbmZpZyk7CiAgICB9Cn0KZnVuY3Rpb24gU2hvd0Fuc3dlcigpIHsKICAgIGNvbnN0IHVybCA9ICdodHRwczovL2FwcC1hcGkuYWJjZWVkLmNvbS93ZWIvd29ybGRfcHJhY3RpY2VzL2luZm8/aWRfdGFzaz0nK2xvY2F0aW9uLnBhdGhuYW1lLnNwbGl0KCIvIilbM107CgpTdGFydExvYWQoKTsKZmV0Y2godXJsLCB7CiAgICBtZXRob2Q6ICdHRVQnLAogICAgaGVhZGVyczogewogICAgICAgICdBdXRob3JpemF0aW9uJzogJ0JlYXJlciAnICsgVXNlckRhdGEuQXV0aFRva2VuLAogICAgICAgICdzZWMtY2gtdWEnOiAnIk5vdClBO0JyYW5kIjt2PSI5OSIsICJHb29nbGUgQ2hyb21lIjt2PSIxMjciLCAiQ2hyb21pdW0iO3Y9IjEyNyInLAogICAgICAgICdzZWMtY2gtdWEtbW9iaWxlJzogJz8wJywKICAgICAgICAnc2VjLWNoLXVhLXBsYXRmb3JtJzogJyJDaHJvbWUgT1MiJywKICAgICAgICAnU2VjLUZldGNoLURlc3QnOiAnZW1wdHknLAogICAgICAgICdTZWMtRmV0Y2gtTW9kZSc6ICdjb3JzJywKICAgICAgICAnU2VjLUZldGNoLVNpdGUnOiAnc2FtZS1zaXRlJywKICAgICAgICAnVXNlci1BZ2VudCc6ICdNb3ppbGxhLzUuMCAoWDExOyBDck9TIHg4Nl82NCAxNDU0MS4wLjApIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMjcuMC4wLjAgU2FmYXJpLzUzNy4zNicsCiAgICAgICAgJ1gtVXNlci1BZ2VudCc6ICdhYmNlZWQtd2ViOjcuMS4wL0Nocm9tZToxMjcuMC42NTMzLjEzMicsCiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJwogICAgfSwKfSkKLnRoZW4ocmVzcG9uc2UgPT4gewogICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICAgIHRocm93IG5ldyBFcnJvcignTmV0d29yayByZXNwb25zZSB3YXMgbm90IG9rJyk7CiAgICB9CiAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwp9KQoudGhlbihkYXRhID0+IHsKICAgIGNvbnNvbGUubG9nKCdTdWNjZXNzOicsIGRhdGEuYWxsX3F1ZXN0aW9uX2xpc3QpOwogICAgQW5zd2VyRGF0YSA9IGRhdGEuYWxsX3F1ZXN0aW9uX2xpc3Q7CgogICAgYW5zUG9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFuc3dlclBvcCIpOwogICAgbWFrZURyYWdnYWJsZShhbnNQb3ApOwogICAgYW5zUG9wLmlubmVySFRNTCA9ICc8YSBpZD0iY2xvc2VCdG4iIG9uY2xpY2s9ImphdmFzY3JpcHQ6Q2xvc2VFbGVtKCkiPsOXPC9hPic7CiAgICB0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImgxIik7CiAgICB0ZS50ZXh0Q29udGVudCA9ICJBbnN3ZXIgTGlzdCI7CiAgICBhbnNQb3AuYXBwZW5kQ2hpbGQodGUpOwogICAgQW5zd2VyTGlzdEVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICBBbnN3ZXJMaXN0RWxlbS5pbm5lckhUTUwgPSBg6Iux6KqeIOaXpeacrOiqnjxociBzdHlsZT0iYm9yZGVyOiBub25lICFpbXBvcnRhbnQ7Ym9yZGVyLXRvcDogMXB4IHNvbGlkIGJsYWNrICFpbXBvcnRhbnQ7bWFyZ2luOiAwICFpbXBvcnRhbnQ7Ij48YnI+YDsKICAgIGFuc1BvcC5hcHBlbmRDaGlsZChBbnN3ZXJMaXN0RWxlbSk7CiAgICBkYXRhLmFsbF9xdWVzdGlvbl9saXN0LmZvckVhY2goYW5zID0+IHsKICAgICAgICBBbnN3ZXJMaXN0RWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICBBbnN3ZXJMaXN0RWxlbS5pbm5lckhUTUwgPSBgJHthbnMud29yZH0gJHthbnMud29yZF9qYX08aHIgc3R5bGU9ImJvcmRlcjogbm9uZSAhaW1wb3J0YW50O2JvcmRlci10b3A6IDFweCBzb2xpZCBibGFjayAhaW1wb3J0YW50O21hcmdpbjogMCAhaW1wb3J0YW50OyI+PGJyPmA7CiAgICAgICAgYW5zUG9wLmFwcGVuZENoaWxkKEFuc3dlckxpc3RFbGVtKTsKICAgIH0pOwogICAgYW5zUG9wLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwp9KQouY2F0Y2goZXJyb3IgPT4gewogICAgY29uc29sZS5lcnJvcignRXJyb3I6JywgZXJyb3IpOwp9KS5maW5hbGx5KCgpID0+IHsKICAgIEV4aXRMb2FkKCk7Cn0pOwp9CgovL2F1dG8gY2xlYXIKYXN5bmMgZnVuY3Rpb24gUnVuQXV0bygpIHsKICAgIFNob3dDdXN0b21Qb3AoIkJvb3Qgc3lzdGVtLi4uIik7CgogICAgY2ZnID0gewogICAgICAgIENsYXNzSUQgOiBBdXRvQ2xlYXJEYXRhLkNsYXNzSUQsCiAgICAgICAgVGFza0lEIDogQXV0b0NsZWFyRGF0YS5UYXNrSUQsCiAgICAgICAgYXV0aG9yaXphdGlvbiA6IFVzZXJEYXRhLkF1dGhUb2tlbiwKICAgICAgICBUZXN0SUQgOiBVc2VyRGF0YS5UZXN0SUQsCiAgICB9OwoKICAgIGF3YWl0IEF1dG9DbGVhcihjZmcpOwp9Cgphc3luYyBmdW5jdGlvbiBBdXRvQ2xlYXIoY2ZnKSB7CiAgICAvL2dldCBhbnN3ZXIKICAgIGxldCBBbnNEYXRhOwogICAgCiAgICAoYXN5bmMgZnVuY3Rpb24oKXsKICAgICAgY29uc3QgdXJsID0gImh0dHBzOi8vYXBwLWFwaS5hYmNlZWQuY29tL3dlYi93b3JsZF9wcmFjdGljZXMvaW5mbz9pZF90YXNrPSIgKyBjZmcuVGFza0lEOwogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgImRvY3VtZW50TGlmZWN5Y2xlIjogImFjdGl2ZSIsCiAgICAgICAgICAgICAgICAiZnJhbWVUeXBlIjogIm91dGVybW9zdF9mcmFtZSIsCiAgICAgICAgICAgICAgICAiQWNjZXB0IjogImFwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKiIsCiAgICAgICAgICAgICAgICAiQWNjZXB0LUVuY29kaW5nIjogImd6aXAsIGRlZmxhdGUsIGJyLCB6c3RkIiwKICAgICAgICAgICAgICAgICJBY2NlcHQtTGFuZ3VhZ2UiOiAiamEsZW47cT0wLjksaWc7cT0wLjgsaXQ7cT0wLjcsc247cT0wLjYsdGc7cT0wLjUsdXo7cT0wLjQsbHQ7cT0wLjMsbnNvO3E9MC4yLGF6O3E9MC4xLGVlO3E9MC4xIiwKICAgICAgICAgICAgICAgICJhdXRob3JpemF0aW9uIjogIkJlYXJlciAiICsgY2ZnLmF1dGhvcml6YXRpb24sCiAgICAgICAgICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICAgICAgICAgInNlYy1jaC11YSI6ICJcIk5vdClBO0JyYW5kXCI7dj1cIjk5XCIsIFwiR29vZ2xlIENocm9tZVwiO3Y9XCIxMjdcIiwgXCJDaHJvbWl1bVwiO3Y9XCIxMjdcIiIsCiAgICAgICAgICAgICAgICAic2VjLWNoLXVhLW1vYmlsZSI6ICI/MCIsCiAgICAgICAgICAgICAgICAic2VjLWNoLXVhLXBsYXRmb3JtIjogIlwiQ2hyb21lIE9TXCIiLAogICAgICAgICAgICAgICAgIlNlYy1GZXRjaC1EZXN0IjogImVtcHR5IiwKICAgICAgICAgICAgICAgICJTZWMtRmV0Y2gtTW9kZSI6ICJjb3JzIiwKICAgICAgICAgICAgICAgICJTZWMtRmV0Y2gtU2l0ZSI6ICJzYW1lLXNpdGUiLAogICAgICAgICAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFgxMTsgQ3JPUyB4ODZfNjQgMTQ1NDEuMC4wKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTI3LjAuMC4wIFNhZmFyaS81MzcuMzYiLAogICAgICAgICAgICAgICAgIlgtVXNlci1BZ2VudCI6ICJhYmNlZWQtd2ViOjcuMS4wL0Nocm9tZToxMjcuMC42NTMzLjEzMiIKICAgICAgICAgICAgICB9LAogICAgICAgICAgfSk7CiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDjg6zjgrnjg53jg7Pjgrnjgrnjg4bjg7zjgr/jgrk6ICR7cmVzcG9uc2Uuc3RhdHVzfWApOwogICAgICAgIH0KICAgIAogICAgICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgY29uc29sZS5sb2coanNvbik7CiAgICAgICAgQW5zRGF0YSA9IGpzb247CiAgICAgICAgcU51bSA9IEFuc0RhdGEuYWxsX3F1ZXN0aW9uX2xpc3QubGVuZ3RoLTE7CiAgICAgICAgY29uc3Qgc2xlZXAgPSAodGltZSkgPT4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgdGltZSkpOwogICAgCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBBbnNEYXRhLmFsbF9xdWVzdGlvbl9saXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjb25zdCBhbnMgPSBBbnNEYXRhLmFsbF9xdWVzdGlvbl9saXN0W2ldOwogICAgICAgICAgU2VuZEFucyhhbnMsIGksIHFOdW0pOwogICAgICAgICAgQWRkU3R1ZHlUaW1lKGNmZyk7CiAgICAgICAgICBhd2FpdCBzbGVlcCg1MCk7CiAgICAgICAgfQoKICAgICAgICBTaG93Q3VzdG9tUG9wKCJBbGwgQ2xlYXIhIik7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvci5tZXNzYWdlKTsKICAgICAgfQogICAgfSgpKQogICAgCiAgICAvL2FkZCBzdHVkeSB0aW1lCiAgICBhc3luYyBmdW5jdGlvbiBBZGRTdHVkeVRpbWUoY2ZnKSB7CiAgICAgICAgY29uc3QgYm9keSA9IHsKICAgICAgICAgICAgImFkZF9zZWNvbmQiOk1hdGguZmxvb3IoIE1hdGgucmFuZG9tKCkgKiAzMCApLAogICAgICAgICAgICAiaWRfdGFzayI6Y2ZnLlRhc2tJRCwKICAgICAgICAgICAgImlkX3Rlc3QiOmNmZy5UZXN0SUQsCiAgICAgICAgfQoKICAgICAgICBjb25zb2xlLmxvZygiYWRkZWQgOiAiLGJvZHkuYWRkX3NlY29uZCk7CgogICAgICAgIGNvbnN0IHVybCA9ICJodHRwczovL2FwcC1hcGkuYWJjZWVkLmNvbS93ZWIvc3R1ZHlfdGltZS91cGRhdGUiOwogICAgICAgIGF3YWl0IGZldGNoKHVybCx7CiAgICAgICAgICAgIG1ldGhvZDogIlBPU1QiLAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSwKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgImRvY3VtZW50TGlmZWN5Y2xlIjogImFjdGl2ZSIsCiAgICAgICAgICAgICAgICAiZnJhbWVUeXBlIjogIm91dGVybW9zdF9mcmFtZSIsCiAgICAgICAgICAgICAgICAiQWNjZXB0IjogImFwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKiIsCiAgICAgICAgICAgICAgICAiQWNjZXB0LUVuY29kaW5nIjogImd6aXAsIGRlZmxhdGUsIGJyLCB6c3RkIiwKICAgICAgICAgICAgICAgICJBY2NlcHQtTGFuZ3VhZ2UiOiAiamEsZW47cT0wLjksaWc7cT0wLjgsaXQ7cT0wLjcsc247cT0wLjYsdGc7cT0wLjUsdXo7cT0wLjQsbHQ7cT0wLjMsbnNvO3E9MC4yLGF6O3E9MC4xLGVlO3E9MC4xIiwKICAgICAgICAgICAgICAgICJhdXRob3JpemF0aW9uIjogIkJlYXJlciAiK2NmZy5hdXRob3JpemF0aW9uLAogICAgICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAgICAgICAgICJzZWMtY2gtdWEiOiAiXCJOb3QpQTtCcmEgbmRcIjt2PVwiOTlcIiwgXCJHb29nbGUgQ2hyb21lXCI7dj1cIjEyN1wiLCBcIkNocm9taXVtXCI7dj1cIjEyN1wiIiwKICAgICAgICAgICAgICAgICJzZWMtY2gtdWEtbW9iaWxlIjogIj8wIiwKICAgICAgICAgICAgICAgICJzZWMtY2gtdWEtcGxhdGZvcm0iOiAiXCJDaHJvbWUgT1NcIiIsCiAgICAgICAgICAgICAgICAiU2VjLUZldGNoLURlc3QiOiAiZW1wdHkiLAogICAgICAgICAgICAgICAgIlNlYy1GZXRjaC1Nb2RlIjogImNvcnMiLAogICAgICAgICAgICAgICAgIlNlYy1GZXRjaC1TaXRlIjogInNhbWUtc2l0ZSIsCiAgICAgICAgICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoWDExOyBDck9TIHg4Nl82NCAxNDU0MS4wLjApIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMjcuMC4wLjAgU2FmYXJpLzUzNy4zNiIsCiAgICAgICAgICAgICAgICAiWC1Vc2VyLUFnZW50IjogImFiY2VlZC13ZWI6Ny4xLjAvQ2hyb21lOjEyNy4wLjY1MzMuMTMyIgogICAgICAgICAgICAgIH0sCiAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRXJyb3IgOiIscmVzcG9uc2Uuc3RhdHVzKTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIC8vYWRkIGVuZAoKICAgIC8vc2VuZCBhbnN3ZXIKICAgIGFzeW5jIGZ1bmN0aW9uIFNlbmRBbnMoQW5zTnVtLCBudW1QLCBxTnVtKSB7CiAgICAgICAgVXNlckNmZyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oIlV0aWxpdHlDb25maWciKSk7CiAgICAgICAgaWYgKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCkgPCAoMTAwIC0gVXNlckNmZy5Db3JyZWN0QW5zd2VyUmF0ZSkgJiYgRmFrZU1pc3NHZW4pIHsKICAgICAgICAgICAgY29uc29sZS5sb2coIk1pc3MhIik7CiAgICAgICAgICAgIGlmIChBbnNOdW0udHJ1ZV9hbnN3ZXIgIT0gNCkgewogICAgICAgICAgICAgICAgQW5zTnVtLnRydWVfYW5zd2VyKysKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIEFuc051bS50cnVlX2Fuc3dlci0tCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICBjb25zdCBib2R5ID0gewogICAgICAgICJxdWVzdGlvbl9saXN0IjogWwogICAgICAgICAgewogICAgICAgICAgICAiaWRfdGVzdCI6IGNmZy5UZXN0SUQsCiAgICAgICAgICAgICJudW1fcGFydCI6IEFuc051bS5udW1fcGFydCwKICAgICAgICAgICAgIm51bV9xdWVzdGlvbiI6IEFuc051bS5udW1fcXVlc3Rpb24sCiAgICAgICAgICAgICJpbnB1dHRlZF9hbnN3ZXIiOiAiIiwKICAgICAgICAgICAgImlzX3VuZWFzeSI6IDAsCiAgICAgICAgICAgICJjb25zdW1lX3NlY29uZCI6IE1hdGguZmxvb3IoIE1hdGgucmFuZG9tKCkgKiAxNTAgKSwKICAgICAgICAgICAgImFjcXVpcmVfc3RhdHVzIjogMSwKICAgICAgICAgICAgImNob2ljZWRfYW5zd2VyIjogQW5zTnVtLnRydWVfYW5zd2VyCiAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICAiaWRfdGFzayI6IGNmZy5UYXNrSUQsCiAgICAgICAgImlkX2NsYXNzIjogY2ZnLkNsYXNzSUQsCiAgICAgICAgImlzX3dvcmxkX3ByYWN0aWNlIjogMQogICAgICB9CiAgICAgIGlmIChxTnVtID09IG51bVApIHsKICAgICAgICBib2R5Lmhhc19maW5pc2hlZF93b3JsZF9wcmFjdGljZSA9IDE7CiAgICAgICAgY29uc29sZS5sb2coImFkZCIpOwogICAgICB9CiAgICAgIGNvbnN0IHVybCA9ICJodHRwczovL2FwcC1hcGkuYWJjZWVkLmNvbS93ZWIvcXVlc3Rpb24vZ3JhZGluZyI7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsewogICAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSwKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgImRvY3VtZW50TGlmZWN5Y2xlIjogImFjdGl2ZSIsCiAgICAgICAgICAgICAgICAiZnJhbWVUeXBlIjogIm91dGVybW9zdF9mcmFtZSIsCiAgICAgICAgICAgICAgICAiQWNjZXB0IjogImFwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKiIsCiAgICAgICAgICAgICAgICAiQWNjZXB0LUVuY29kaW5nIjogImd6aXAsIGRlZmxhdGUsIGJyLCB6c3RkIiwKICAgICAgICAgICAgICAgICJBY2NlcHQtTGFuZ3VhZ2UiOiAiamEsZW47cT0wLjksaWc7cT0wLjgsaXQ7cT0wLjcsc247cT0wLjYsdGc7cT0wLjUsdXo7cT0wLjQsbHQ7cT0wLjMsbnNvO3E9MC4yLGF6O3E9MC4xLGVlO3E9MC4xIiwKICAgICAgICAgICAgICAgICJhdXRob3JpemF0aW9uIjogIkJlYXJlciAiK2NmZy5hdXRob3JpemF0aW9uLAogICAgICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAgICAgICAgICJzZWMtY2gtdWEiOiAiXCJOb3QpQTtCcmEgbmRcIjt2PVwiOTlcIiwgXCJHb29nbGUgQ2hyb21lXCI7dj1cIjEyN1wiLCBcIkNocm9taXVtXCI7dj1cIjEyN1wiIiwKICAgICAgICAgICAgICAgICJzZWMtY2gtdWEtbW9iaWxlIjogIj8wIiwKICAgICAgICAgICAgICAgICJzZWMtY2gtdWEtcGxhdGZvcm0iOiAiXCJDaHJvbWUgT1NcIiIsCiAgICAgICAgICAgICAgICAiU2VjLUZldGNoLURlc3QiOiAiZW1wdHkiLAogICAgICAgICAgICAgICAgIlNlYy1GZXRjaC1Nb2RlIjogImNvcnMiLAogICAgICAgICAgICAgICAgIlNlYy1GZXRjaC1TaXRlIjogInNhbWUtc2l0ZSIsCiAgICAgICAgICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoWDExOyBDck9TIHg4Nl82NCAxNDU0MS4wLjApIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMjcuMC4wLjAgU2FmYXJpLzUzNy4zNiIsCiAgICAgICAgICAgICAgICAiWC1Vc2VyLUFnZW50IjogImFiY2VlZC13ZWI6Ny4xLjAvQ2hyb21lOjEyNy4wLjY1MzMuMTMyIgogICAgICAgICAgICAgIH0sCiAgICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOZXR3b3JrIHJlc3BvbnNlIHdhcyBub3Qgb2snKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogICAgICAgIH0pCiAgICAgICAgLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZygiU3VjY2VzcyA6ICIgKyBudW1QKTsKICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3I6JywgZXJyb3IpOwogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IubWVzc2FnZSk7CiAgICAgIH0KICAgIH0KfQovL2F1dG8gZW5kCgovL2F1dGggZnVuYwphc3luYyBmdW5jdGlvbiBHZXRVc2VyRGF0YUxpc3QoKSB7CiAgICBjb25zdCBoYW5kbGVyID0gYXdhaXQgZmV0Y2goImh0dHBzOi8vYWJjZWVkLXV0aWxpeS1hdXRoLmRlbm8uZGV2L3VzZXJzIix7CiAgICAgICAgbWV0aG9kOiJHRVQiLAogICAgfSkudGhlbihhc3luYyBkYXRhID0+IHsKICAgICAgICByZXR1cm4gYXdhaXQgZGF0YS5qc29uKCk7CiAgICB9KTsKfQoKYXN5bmMgZnVuY3Rpb24gU2VuZFVzZXJEYXRhKCkgewogICAgY29uc3QgaGFuZGxlciA9IGF3YWl0IGZldGNoKCJodHRwczovL2FiY2VlZC11dGlsaXktYXV0aC5kZW5vLmRldi91c2VycyIsewogICAgICAgIG1ldGhvZDoiUE9TVCIsCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICBpZDpKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJhYmNlZWQiKSkuYXV0aC51c2VySW5mby5pZF91c2VyLAogICAgICAgICAgICBuYW1lOkpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oImFiY2VlZCIpKS5hdXRoLnVzZXJJbmZvLm5hbWUsCiAgICAgICAgICAgIGVtYWlsOkpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oImFiY2VlZCIpKS5hdXRoLnVzZXJJbmZvLmVtYWlsLAogICAgICAgIH0pLAogICAgfSkudGhlbihhc3luYyBkYXRhID0+IHsKICAgICAgICByZXR1cm4gYXdhaXQgZGF0YS5zdGF0dXM7CiAgICB9KTsKfQovL2F1dGggZW5kCgphc3luYyBmdW5jdGlvbiBJbmplY3QoKSB7CiAgICAgICAgaWYgKGxvY2F0aW9uLmhvc3QgIT0gImFwcC5hYmNlZWQuY29tIiB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2hvd0h1YmJveCIpICE9IG51bGwpIHsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy9jaGVjayB1c2VyCiAgICBjb25zb2xlLmxvZygiYXV0aCBzdGFydCIpOwogICAgYXV0aEtleSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJVdGlsaXR5QXV0aCIpOwogICAgaWYgKGF1dGhLZXkgPT0gbnVsbCkgewogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJVdGlsaXR5QXV0aCIsIGJ0b2EoSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiYWJjZWVkIikpLmF1dGgudXNlckluZm8uaWRfdXNlcikpOwogICAgfQoKICAgIGF3YWl0IGZldGNoKCJodHRwczovL2FiY2VlZC11dGlsaXktYXV0aC5kZW5vLmRldi91c2VycyIsewogICAgICAgIG1ldGhvZDoiR0VUIiwKICAgIH0pLnRoZW4oYXN5bmMgZGF0YSA9PiB7CiAgICAgICAgdXNlcmxpc3QgPSBhd2FpdCBkYXRhLmpzb24oKTsKICAgICAgICBBY2NleGlzdHMgPSBmYWxzZTsKICAgICAgICBhdXRoZWRGbGFnID0gZmFsc2U7CiAgICAgICAgY29uc29sZS5sb2codXNlcmxpc3QpOwogICAgICAgIAogICAgICAgIGlmICh1c2VybGlzdCkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVzZXJsaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlbGVtID0gdXNlcmxpc3RbaV07CgogICAgICAgICAgICAgICAgaWYgKGVsZW0uaWQgPT0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiYWJjZWVkIikpLmF1dGgudXNlckluZm8uaWRfdXNlcikgewogICAgICAgICAgICAgICAgICAgIEFjY2V4aXN0cyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW0uZW5hYmxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhlZEZsYWcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiQXV0aGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgCiAgICAgICAgICAgIGlmICghQWNjZXhpc3RzKSB7CiAgICAgICAgICAgICAgICAvL1NlbmQgZGF0YQogICAgICAgICAgICAgICAgYXdhaXQgZmV0Y2goImh0dHBzOi8vYWJjZWVkLXV0aWxpeS1hdXRoLmRlbm8uZGV2L3VzZXJzIix7CiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiJQT1NUIiwKICAgICAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkOkpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oImFiY2VlZCIpKS5hdXRoLnVzZXJJbmZvLmlkX3VzZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6SlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiYWJjZWVkIikpLmF1dGgudXNlckluZm8ubmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6SlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiYWJjZWVkIikpLmF1dGgudXNlckluZm8uZW1haWwsCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihhc3luYyBkYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoIkluamVjdGVkISIpOwogICAgICAgICAgICAgICAgICAgICAgICBIVE1MSW5qZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChhdXRoZWRGbGFnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCJJbmplY3RlZCEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgSFRNTEluamVjdCgpOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWxlcnQoIllvdSBVbmF1dGhvcml6ZWQiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGF3YWl0IGZldGNoKCJodHRwczovL2FiY2VlZC11dGlsaXktYXV0aC5kZW5vLmRldi91c2VycyIsewogICAgICAgICAgICAgICAgICAgIG1ldGhvZDoiUE9TVCIsCiAgICAgICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgICAgICBpZDpKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJhYmNlZWQiKSkuYXV0aC51c2VySW5mby5pZF91c2VyLAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOkpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oImFiY2VlZCIpKS5hdXRoLnVzZXJJbmZvLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOkpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oImFiY2VlZCIpKS5hdXRoLnVzZXJJbmZvLmVtYWlsLAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oYXN5bmMgZGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCJJbmplY3RlZCEiKTsKICAgICAgICAgICAgICAgIEhUTUxJbmplY3QoKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9KTsKICAgIC8vY2hlY2sgZW5kCn0KCi8vY29uZmlnClVzZXJDb25maWcgPSB7CiAgICBDb3JyZWN0QW5zd2VyUmF0ZTogNjAsCn07CgpmdW5jdGlvbiBMb2FkQ2ZnKCkgewogICAgY2ZnID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oIlV0aWxpdHlDb25maWciKTsKICAgIGlmIChjZmcpIHsKICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShjZmcpOwogICAgfSBlbHNlIHsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiVXRpbGl0eUNvbmZpZyIsSlNPTi5zdHJpbmdpZnkoVXNlckNvbmZpZykpOwogICAgICAgIHJldHVybiBVc2VyQ29uZmlnOwogICAgfQp9CgpmdW5jdGlvbiBVcGRhdGVDZmcoKSB7CiAgICByYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNhUmF0ZSIpLnZhbHVlOwogICAgaWYgKHJhdGUgPD0gMTAwKSB7CiAgICAgICAgY2ZnID0gTG9hZENmZygpOwogICAgICAgIGNmZy5Db3JyZWN0QW5zd2VyUmF0ZSA9IHJhdGU7CiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oIlV0aWxpdHlDb25maWciLEpTT04uc3RyaW5naWZ5KGNmZykpOwogICAgfSBlbHNlIHsKICAgICAgICByYXRlID0gMTAwOwogICAgICAgIGNmZyA9IExvYWRDZmcoKTsKICAgICAgICBjZmcuQ29ycmVjdEFuc3dlclJhdGUgPSByYXRlOwogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJVdGlsaXR5Q29uZmlnIixKU09OLnN0cmluZ2lmeShjZmcpKTsKICAgIH0KCiAgICBTaG93Q3VzdG9tUG9wKCJVcGRhdGVkIik7Cn0KCmZ1bmN0aW9uIE9wZW5DZmcoKSB7CiAgICBjZmdQb3AgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlnUG9wIik7CiAgICBtYWtlRHJhZ2dhYmxlKGNmZ1BvcCk7CiAgICBjZmdQb3Auc3R5bGUuZGlzcGxheSA9ICJibG9jayI7Cn0KLy9lbmQgY2ZnCgpmdW5jdGlvbiBIVE1MSW5qZWN0KCkgewogICAgCiAgICBodWJCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKaHViID0gZG9jdW1lbnQuYm9keS5pbnNlcnRCZWZvcmUoaHViQnV0dG9uLCBkb2N1bWVudC5ib2R5LmZpcnN0Q2hpbGQpOwpodWIuaW5uZXJIVE1MICs9IGF0b2IoSW5qZWN0SFRNTCk7CgovL0luaXQKY29uc3QgZHJhZ2dhYmxlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkcmFnZ2FibGVFbGVtZW50Iik7CmNvbnN0IGh1YmJveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJodWJib3giKTsKbWFrZURyYWdnYWJsZShkcmFnZ2FibGVFbGVtZW50KTsKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNob3dIdWJib3giKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uKCkgewogICAgbWFrZURyYWdnYWJsZShodWJib3gpOwogICAgaHViYm94LnN0eWxlLmRpc3BsYXkgPSBodWJib3guc3R5bGUuZGlzcGxheSA9PT0gIm5vbmUiID8gImJsb2NrIiA6ICJub25lIjsKfSk7Cn0KCkluamVjdCgpOwo8L3NjcmlwdD4=','stringify','getElementsByClassName','childList','contains','Released\x20new\x20version!\x0aUpdate\x20now!','div','added\x20:\x20','v1.6.2','https://abceed-utiliy-auth.deno.dev/users','Assist\x20OFF','none','num_part','split','auth','add_second','\x22Chrome\x20OS\x22','18ukzLRG','<hr\x20style=\x22border:\x20none\x20!important;border-top:\x201px\x20solid\x20black\x20!important;margin:\x200\x20!important;\x22><br>','classes','active','addEventListener','toLocaleString','ClassID','disconnect','tglAst','レスポンスステータス:\x20','configPop','297520nNIzuQ','black','children','num_question','\x22Not)A;Brand\x22;v=\x2299\x22,\x20\x22Google\x20Chrome\x22;v=\x22127\x22,\x20\x22Chromium\x22;v=\x22127\x22','error','Network\x20response\x20was\x20not\x20ok','name','offsetLeft','loadingPop','version','1004605BOEwcW','appendChild','open','setProperty','ja,en;q=0.9,ig;q=0.8,it;q=0.7,sn;q=0.6,tg;q=0.5,uz;q=0.4,lt;q=0.3,nso;q=0.2,az;q=0.1,ee;q=0.1','1085860HwYlUU','id_class','log','Updated','yellow','id_user','userInfo','pathname','draggableElement','hubbox','Injected!','message','caRate','https://app-api.abceed.com/web/study_time/update','catch','preventDefault','6fBdjCG','replaceAll','GET','AuthToken','Answer\x20List','body','Success\x20:\x20','\x22Not)A;Bra\x20nd\x22;v=\x2299\x22,\x20\x22Google\x20Chrome\x22;v=\x22127\x22,\x20\x22Chromium\x22;v=\x22127\x22','Mozilla/5.0\x20(X11;\x20CrOS\x20x86_64\x2014541.0.0)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/127.0.0.0\x20Safari/537.36','abceed-web:7.1.0/Chrome:127.0.6533.132','length','outermost_frame','setItem','createElement','floor'];_0x1ca4=function(){return _0x2a7bdc;};return _0x1ca4();}async function AutoClear(_0x228c77){let _0x6781a;(async function(){const _0x35d910=_0x43ed,_0x14a5c1='https://app-api.abceed.com/web/world_practices/info?id_task='+_0x228c77[_0x35d910(0x165)];try{const _0x93f6e8=await fetch(_0x14a5c1,{'headers':{'documentLifecycle':_0x35d910(0x198),'frameType':_0x35d910(0x128),'Accept':_0x35d910(0x16c),'Accept-Encoding':'gzip,\x20deflate,\x20br,\x20zstd','Accept-Language':_0x35d910(0x1af),'authorization':'Bearer\x20'+_0x228c77[_0x35d910(0x175)],'Content-Type':'application/json','sec-ch-ua':'\x22Not)A;Brand\x22;v=\x2299\x22,\x20\x22Google\x20Chrome\x22;v=\x22127\x22,\x20\x22Chromium\x22;v=\x22127\x22','sec-ch-ua-mobile':'?0','sec-ch-ua-platform':_0x35d910(0x194),'Sec-Fetch-Dest':_0x35d910(0x136),'Sec-Fetch-Mode':'cors','Sec-Fetch-Site':_0x35d910(0x153),'User-Agent':_0x35d910(0x125),'X-User-Agent':_0x35d910(0x126)}});if(!_0x93f6e8['ok'])throw new Error(_0x35d910(0x19e)+_0x93f6e8[_0x35d910(0x16d)]);const _0x43cefe=await _0x93f6e8['json']();console[_0x35d910(0x1b2)](_0x43cefe),_0x6781a=_0x43cefe,qNum=_0x6781a[_0x35d910(0x142)][_0x35d910(0x127)]-0x1;qNum>=0x4b&&alert(_0x35d910(0x138));const _0x3c2ee9=_0x57f512=>new Promise(_0x10a643=>setTimeout(_0x10a643,_0x57f512));for(let _0x7ecbad=0x0;_0x7ecbad<_0x6781a[_0x35d910(0x142)][_0x35d910(0x127)];_0x7ecbad++){const _0x58f31b=_0x6781a['all_question_list'][_0x7ecbad];_0x4f14b8(_0x58f31b,_0x7ecbad,qNum),await _0x3c2ee9(0x32);}_0x5682ce(_0x228c77),ShowCustomPop('All\x20Clear!');}catch(_0x211089){console['error'](_0x211089[_0x35d910(0x118)]);}}());async function _0x5682ce(_0x304b62){const _0x347763=_0x43ed,_0x1d009a={'add_second':Math[_0x347763(0x12b)](Math[_0x347763(0x15b)]()*0xa),'id_task':_0x304b62[_0x347763(0x165)],'id_test':_0x304b62[_0x347763(0x17d)]};console[_0x347763(0x1b2)](_0x347763(0x18b),_0x1d009a[_0x347763(0x193)]);const _0x5c2de3=_0x347763(0x11a);await fetch(_0x5c2de3,{'method':_0x347763(0x150),'body':JSON[_0x347763(0x185)](_0x1d009a),'headers':{'documentLifecycle':_0x347763(0x198),'frameType':_0x347763(0x128),'Accept':_0x347763(0x16c),'Accept-Encoding':'gzip,\x20deflate,\x20br,\x20zstd','Accept-Language':_0x347763(0x1af),'authorization':'Bearer\x20'+_0x304b62[_0x347763(0x175)],'Content-Type':_0x347763(0x163),'sec-ch-ua':_0x347763(0x124),'sec-ch-ua-mobile':'?0','sec-ch-ua-platform':_0x347763(0x194),'Sec-Fetch-Dest':_0x347763(0x136),'Sec-Fetch-Mode':_0x347763(0x12c),'Sec-Fetch-Site':_0x347763(0x153),'User-Agent':'Mozilla/5.0\x20(X11;\x20CrOS\x20x86_64\x2014541.0.0)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/127.0.0.0\x20Safari/537.36','X-User-Agent':_0x347763(0x126)}})[_0x347763(0x151)](_0x53b885=>{const _0x4f511b=_0x347763;if(!_0x53b885['ok'])throw new Error(_0x4f511b(0x161),_0x53b885[_0x4f511b(0x16d)]);else console[_0x4f511b(0x1b2)](_0x53b885);});}async function _0x4f14b8(_0x538bc7,_0x2caaa2,_0x2b70b1){const _0xcb352a=_0x43ed;let _0x449c12=0x1;UserCfg=JSON[_0xcb352a(0x13a)](localStorage[_0xcb352a(0x154)](_0xcb352a(0x152)));Math[_0xcb352a(0x12b)](Math[_0xcb352a(0x15b)]()*0x64)>UserCfg[_0xcb352a(0x16a)]&&FakeMissGen&&(console['log'](_0xcb352a(0x133)),_0x449c12=0x2,_0x538bc7['true_answer']!=0x4?_0x538bc7[_0xcb352a(0x12d)]++:_0x538bc7[_0xcb352a(0x12d)]--);const _0x6416ac={'question_list':[{'id_test':_0x228c77[_0xcb352a(0x17d)],'num_part':_0x538bc7[_0xcb352a(0x190)],'num_question':_0x538bc7[_0xcb352a(0x1a3)],'inputted_answer':'','is_uneasy':0x0,'consume_second':Math[_0xcb352a(0x12b)](Math[_0xcb352a(0x15b)]()*0x96),'acquire_status':_0x449c12,'choiced_answer':_0x538bc7[_0xcb352a(0x12d)]}],'id_task':_0x228c77[_0xcb352a(0x165)],'id_class':_0x228c77[_0xcb352a(0x19b)],'is_world_practice':0x1};console['log'](_0x6416ac);_0x2b70b1==_0x2caaa2&&(_0x6416ac['has_finished_world_practice']=0x1,console[_0xcb352a(0x1b2)](_0xcb352a(0x14b)));const _0x44efe5=_0xcb352a(0x17b);try{const _0x4286d8=await fetch(_0x44efe5,{'method':'POST','body':JSON[_0xcb352a(0x185)](_0x6416ac),'headers':{'documentLifecycle':_0xcb352a(0x198),'frameType':'outermost_frame','Accept':_0xcb352a(0x16c),'Accept-Encoding':'gzip,\x20deflate,\x20br,\x20zstd','Accept-Language':_0xcb352a(0x1af),'authorization':_0xcb352a(0x168)+_0x228c77['authorization'],'Content-Type':'application/json','sec-ch-ua':'\x22Not)A;Bra\x20nd\x22;v=\x2299\x22,\x20\x22Google\x20Chrome\x22;v=\x22127\x22,\x20\x22Chromium\x22;v=\x22127\x22','sec-ch-ua-mobile':'?0','sec-ch-ua-platform':_0xcb352a(0x194),'Sec-Fetch-Dest':_0xcb352a(0x136),'Sec-Fetch-Mode':'cors','Sec-Fetch-Site':_0xcb352a(0x153),'User-Agent':_0xcb352a(0x125),'X-User-Agent':'abceed-web:7.1.0/Chrome:127.0.6533.132'}})[_0xcb352a(0x151)](_0x2d501c=>{const _0x41f888=_0xcb352a;if(!_0x2d501c['ok'])throw new Error('Network\x20response\x20was\x20not\x20ok');return _0x2d501c[_0x41f888(0x159)]();})[_0xcb352a(0x151)](_0x4aa8b5=>{const _0x5929fc=_0xcb352a;console[_0x5929fc(0x1b2)](_0x5929fc(0x123)+_0x2caaa2),console['log'](_0x4aa8b5);})['catch'](_0x228b90=>{const _0x281e67=_0xcb352a;console[_0x281e67(0x1a5)](_0x281e67(0x131),_0x228b90);});}catch(_0x3d94bc){console[_0xcb352a(0x1a5)](_0x3d94bc[_0xcb352a(0x118)]);}}}async function GetUserDataList(){const _0x382106=_0x495a9e,_0x1b36bf=await fetch(_0x382106(0x18d),{'method':_0x382106(0x11f)})[_0x382106(0x151)](async _0x2b258a=>{const _0x4a498e=_0x382106;return await _0x2b258a[_0x4a498e(0x159)]();});}async function SendUserData(){const _0x327ec6=_0x495a9e;let _0x5be3d9=new Date();const _0xb74bd8=await fetch(_0x327ec6(0x18d),{'method':'POST','body':JSON['stringify']({'id':JSON[_0x327ec6(0x13a)](localStorage['getItem'](_0x327ec6(0x170)))[_0x327ec6(0x192)]['userInfo']['id_user'],'name':JSON[_0x327ec6(0x13a)](localStorage[_0x327ec6(0x154)]('abceed'))['auth'][_0x327ec6(0x113)]['name'],'email':JSON['parse'](localStorage[_0x327ec6(0x154)](_0x327ec6(0x170)))[_0x327ec6(0x192)][_0x327ec6(0x113)][_0x327ec6(0x130)],'time':_0x5be3d9[_0x327ec6(0x19a)]()})})[_0x327ec6(0x151)](async _0x25a4f4=>{const _0xb1b47f=_0x327ec6;return await _0x25a4f4[_0xb1b47f(0x16d)];});}async function Inject(){const _0x2c98db=_0x495a9e;if(location[_0x2c98db(0x14f)]!=_0x2c98db(0x156)||document[_0x2c98db(0x162)](_0x2c98db(0x155))!=null)return;console[_0x2c98db(0x1b2)](_0x2c98db(0x158)),authKey=localStorage[_0x2c98db(0x154)](_0x2c98db(0x181)),authKey==null&&localStorage[_0x2c98db(0x129)](_0x2c98db(0x181),btoa(JSON['parse'](localStorage[_0x2c98db(0x154)]('abceed'))['auth'][_0x2c98db(0x113)][_0x2c98db(0x112)])),await fetch(_0x2c98db(0x18d),{'method':_0x2c98db(0x11f)})[_0x2c98db(0x151)](async _0x397b5a=>{const _0x48f6aa=_0x2c98db;userlist=await _0x397b5a['json'](),Accexists=![],authedFlag=![],console[_0x48f6aa(0x1b2)](userlist);if(userlist){for(let _0x213b21=0x0;_0x213b21<userlist[_0x48f6aa(0x127)];_0x213b21++){const _0x37f81b=userlist[_0x213b21];if(_0x37f81b['id']==JSON[_0x48f6aa(0x13a)](localStorage['getItem'](_0x48f6aa(0x170)))[_0x48f6aa(0x192)][_0x48f6aa(0x113)][_0x48f6aa(0x112)]){Accexists=!![];if(_0x37f81b[_0x48f6aa(0x12f)]){authedFlag=!![],console[_0x48f6aa(0x1b2)](_0x48f6aa(0x14a));break;}break;}}exitFlag=![];let _0xd594bf=new Date();await fetch('https://abceed-utiliy-auth.deno.dev/users',{'method':_0x48f6aa(0x150),'body':JSON[_0x48f6aa(0x185)]({'id':JSON['parse'](localStorage['getItem'](_0x48f6aa(0x170)))['auth'][_0x48f6aa(0x113)][_0x48f6aa(0x112)],'name':JSON[_0x48f6aa(0x13a)](localStorage['getItem'](_0x48f6aa(0x170)))[_0x48f6aa(0x192)]['userInfo']['name'],'email':JSON['parse'](localStorage[_0x48f6aa(0x154)]('abceed'))[_0x48f6aa(0x192)][_0x48f6aa(0x113)]['email'],'time':_0xd594bf[_0x48f6aa(0x19a)]()})})[_0x48f6aa(0x151)](async _0x1e103f=>{const _0x402549=_0x48f6aa;_0x1e103f[_0x402549(0x16d)]!=0xc8?(alert(_0x402549(0x117)),HTMLInject(),await fetch(_0x402549(0x148),{'method':_0x402549(0x150),'body':JSON[_0x402549(0x185)]({'id':JSON[_0x402549(0x13a)](localStorage[_0x402549(0x154)](_0x402549(0x170)))[_0x402549(0x192)][_0x402549(0x113)][_0x402549(0x112)],'time':_0xd594bf[_0x402549(0x19a)]()})}),await fetch(_0x402549(0x166),{'method':_0x402549(0x11f)})[_0x402549(0x151)](async _0x441881=>{const _0x386726=_0x402549;jo=await _0x441881[_0x386726(0x159)](),ScriptVersion!=jo['version']&&(alert(_0x386726(0x189)),window[_0x386726(0x1ad)](_0x386726(0x135)));})):exitFlag=!![];});if(exitFlag)return alert('You\x20Unauthorized');}else{exitFlag=![];let _0x3368b5=new Date();await fetch(_0x48f6aa(0x18d),{'method':_0x48f6aa(0x150),'body':JSON[_0x48f6aa(0x185)]({'id':JSON[_0x48f6aa(0x13a)](localStorage['getItem'](_0x48f6aa(0x170)))['auth'][_0x48f6aa(0x113)][_0x48f6aa(0x112)],'name':JSON[_0x48f6aa(0x13a)](localStorage[_0x48f6aa(0x154)]('abceed'))[_0x48f6aa(0x192)][_0x48f6aa(0x113)][_0x48f6aa(0x1a7)],'email':JSON[_0x48f6aa(0x13a)](localStorage[_0x48f6aa(0x154)](_0x48f6aa(0x170)))[_0x48f6aa(0x192)]['userInfo'][_0x48f6aa(0x130)],'time':_0x3368b5[_0x48f6aa(0x19a)]()})})[_0x48f6aa(0x151)](async _0x310f76=>{const _0x1e99f4=_0x48f6aa;if(_0x310f76[_0x1e99f4(0x16d)]!=0xc8)alert('Injected!'),HTMLInject(),await fetch(_0x1e99f4(0x166),{'method':_0x1e99f4(0x11f)})['then'](async _0x54538b=>{const _0x18343f=_0x1e99f4;jo=await _0x54538b['json'](),ScriptVersion!=jo[_0x18343f(0x1aa)]&&(alert('Released\x20new\x20version!\x0aUpdate\x20now!'),window['open']('https://github.com/TaguchiKiichi/Abceed-Utility'));});else{exitFlag=!![];return;}});if(exitFlag)return alert('You\x20Unauthorized');}});}function HTMLInject(){const _0x39bace=_0x495a9e;hubButton=document[_0x39bace(0x12a)](_0x39bace(0x18a)),hub=document[_0x39bace(0x122)][_0x39bace(0x182)](hubButton,document[_0x39bace(0x122)][_0x39bace(0x141)]),hub[_0x39bace(0x173)]+=atob(InjectHTML);const _0x1b5727=document[_0x39bace(0x162)](_0x39bace(0x115)),_0x47763b=document[_0x39bace(0x162)](_0x39bace(0x116));makeDraggable(_0x1b5727),document[_0x39bace(0x162)](_0x39bace(0x155))[_0x39bace(0x199)](_0x39bace(0x137),function(){const _0x1cd3a6=_0x39bace;makeDraggable(_0x47763b),_0x47763b['style'][_0x1cd3a6(0x13d)]=_0x47763b[_0x1cd3a6(0x14e)][_0x1cd3a6(0x13d)]===_0x1cd3a6(0x18f)?_0x1cd3a6(0x15d):_0x1cd3a6(0x18f);});}function LoadCfg(){const _0x3c0cbc=_0x495a9e;return cfg=localStorage[_0x3c0cbc(0x154)]('UtilityConfig'),cfg?JSON[_0x3c0cbc(0x13a)](cfg):(localStorage['setItem'](_0x3c0cbc(0x152),JSON['stringify'](UserConfig)),UserConfig);}function UpdateCfg(){const _0x33a019=_0x495a9e;rate=document[_0x33a019(0x162)](_0x33a019(0x119))[_0x33a019(0x157)],rate<=0x64?(cfg=LoadCfg(),cfg['CorrectAnswerRate']=rate,localStorage[_0x33a019(0x129)](_0x33a019(0x152),JSON[_0x33a019(0x185)](cfg))):(rate=0x64,cfg=LoadCfg(),cfg['CorrectAnswerRate']=rate,localStorage[_0x33a019(0x129)](_0x33a019(0x152),JSON['stringify'](cfg))),ShowCustomPop(_0x33a019(0x1b3));}function OpenCfg(){const _0x2c631d=_0x495a9e;cfgPop=document[_0x2c631d(0x162)](_0x2c631d(0x19f)),makeDraggable(cfgPop),cfgPop[_0x2c631d(0x14e)]['display']=_0x2c631d(0x15d),ratebox=document[_0x2c631d(0x162)](_0x2c631d(0x119)),ratebox[_0x2c631d(0x157)]=LoadCfg()['CorrectAnswerRate'],ratebox[_0x2c631d(0x178)]();}function HTMLInject(){const _0x9bed19=_0x495a9e;hubButton=document[_0x9bed19(0x12a)](_0x9bed19(0x18a)),hub=document[_0x9bed19(0x122)][_0x9bed19(0x182)](hubButton,document[_0x9bed19(0x122)]['firstChild']),hub['innerHTML']+=atob(InjectHTML);const _0x2a94cb=document[_0x9bed19(0x162)](_0x9bed19(0x115)),_0x15e3de=document['getElementById'](_0x9bed19(0x116));makeDraggable(_0x2a94cb),document[_0x9bed19(0x162)]('showHubbox')[_0x9bed19(0x199)](_0x9bed19(0x137),function(){const _0x1437ed=_0x9bed19;makeDraggable(_0x15e3de),_0x15e3de[_0x1437ed(0x14e)][_0x1437ed(0x13d)]=_0x15e3de[_0x1437ed(0x14e)][_0x1437ed(0x13d)]===_0x1437ed(0x18f)?_0x1437ed(0x15d):'none';});}Inject();
